<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 Hokkiao </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f5f7fa;
            --card-bg: #ffffff;
            --text: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            padding-bottom: 80px; /* çµ¦åº•éƒ¨æŒ‰éˆ•ç•™ç©ºé–“ */
        }

        /* --- Header & Nav --- */
        header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .banner-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            /* ğŸ‘‡ è«‹åœ¨é€™è£¡æ›æˆä½ åŸæœ¬çš„åœ–ç‰‡ç¶²å€ ğŸ‘‡ */
            background-image: url('https://images.unsplash.com/photo-1551524559-8af4e6624178?q=80&w=2526&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .header-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .site-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--primary);
            margin: 0;
        }

        .nav-menu {
            display: flex;
            gap: 15px;
        }

        .nav-item {
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            color: #666;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .nav-item i { font-size: 1.2rem; }
        
        .nav-item:hover { background: #f0f0f0; color: var(--accent); }
        .nav-item.active { color: var(--accent); font-weight: bold; }

        /* --- ä¸»è¦å…§å®¹å€ --- */
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .tab-content { display: none; } /* é è¨­éš±è—æ‰€æœ‰åˆ†é  */
        .tab-content.active { display: block; animation: fadeIn 0.3s; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ç·¨è¼¯æ§åˆ¶æŒ‰éˆ• --- */
        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
            background: rgba(255,255,255,0.95);
            padding: 10px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            backdrop-filter: blur(5px);
        }

        button {
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .btn-edit { background: var(--primary); color: white; }
        .btn-save { background: #27ae60; color: white; display: none; }
        
        body.editing .editable {
            border: 1px dashed #999;
            background-color: #fff9c4;
            padding: 2px 5px;
            border-radius: 4px;
            min-height: 1em;
            cursor: text;
        }
        body.editing .btn-save { display: block; }
        body.editing .btn-edit { display: none; }

        /* --- è¡Œç¨‹è¡¨æ¨£å¼ --- */
        .day-section { margin-bottom: 30px; }
        .day-header {
            position: sticky; top: 70px; /* é¿é–‹ header */
            background: var(--bg); padding: 10px 0; z-index: 10;
            border-bottom: 2px solid #ddd;
            display: flex; justify-content: space-between; align-items: center;
        }
        .day-title { font-size: 1.3rem; font-weight: 800; color: var(--primary); }
        .weather-info { font-size: 0.85rem; color: #666; text-align: right; }
        .event-card {
            background: var(--card-bg); border-radius: 12px; padding: 15px;
            margin-bottom: 15px; margin-left: 10px; border-left: 4px solid var(--accent);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: relative; /* ç‚ºäº†åœ°åœ–åœ–ç¤ºå®šä½ */
        }
        .time-badge { background: var(--accent); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-right: 5px;}
        .tag-badge { background: #eee; color: #555; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; }
        .event-title { font-size: 1.1rem; font-weight: bold; margin: 8px 0 4px 0; }
        .event-sub { font-size: 0.9rem; color: #555; }
        .event-note { font-size: 0.85rem; color: #666; background: #f8f9fa; padding: 8px; border-radius: 6px; margin-top: 8px; }
        .map-icon { position: absolute; top: 10px; right: 10px; color: #2ecc71; font-size: 1.2rem; }

        /* --- è³¼ç‰©æ¸…å–®æ¨£å¼ --- */
        .shopping-nav { margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .shopping-nav button { background: #eee; color: var(--text); padding: 5px 15px; border-radius: 5px; font-weight: normal; margin-right: 10px; }
        .shopping-nav button.active { background: var(--accent); color: white; font-weight: bold; }

        .shopping-item {
            display: flex; align-items: flex-start; gap: 10px;
            background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .check-box { font-size: 1.2rem; color: #ddd; cursor: pointer; }
        .check-box.checked { color: #27ae60; }

        /* --- èŠ±è²»è¡¨æ ¼æ¨£å¼ --- */
        .expense-table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .expense-table th, .expense-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        .expense-table th { background: var(--primary); color: white; }
        .total-row { font-weight: bold; background: #f0f0f0; text-align: right; }

        /* --- æ‰‹æ©Ÿç‰ˆå°ˆç”¨å„ªåŒ– (è§£æ±ºæ¨™é¡Œæ¶ˆå¤±å•é¡Œ) --- */
        @media (max-width: 600px) {
            /* è®“åœ–ç‰‡é«˜åº¦åœ¨æ‰‹æ©Ÿä¸Šæ›´å°ä¸€äº›ï¼Œç¯€çœç©ºé–“ */
            .banner-img {
                height: 120px;
            }

            /* ç•¶è¢å¹•å¯¬åº¦å°æ–¼ 600px æ™‚ï¼Œæ¨™é¡Œå’Œå°è¦½åˆ—æ”¹æˆå‚ç›´å †ç–Š */
            .header-content {
                flex-direction: column; /* è®“å…§å®¹ç”±æ©«å‘è®Šæˆç¸±å‘æ’åˆ— */
                align-items: flex-start; /* è®“æ¨™é¡Œé å·¦å°é½Š */
                padding-bottom: 5px; /* ç¸®å°ä¸€é»é–“è· */
            }

            /* è®“æ¨™é¡Œå’Œå°è¦½åˆ—å„è‡ªä½”æ»¿ä¸€è¡Œ */
            .site-title, .nav-menu {
                width: 100%; 
            }

            /* è®“å°è¦½åˆ—çš„åœ–ç¤ºåœ¨æ‰‹æ©Ÿä¸Šå¹³å‡åˆ†æ•£ï¼Œæ¯”è¼ƒå¥½é»æ“Š */
            .nav-menu {
                justify-content: space-around;
                padding-top: 5px;
                border-top: 1px solid #eee; /* åŠ ä¸€æ¢åˆ†éš”ç·š */
            }
        }
    </style>
</head>
<body>

<header>
    <div class="banner-img" title="ä½ å¯ä»¥æŠŠé€™å¼µåœ–æ›æ‰"></div>
    <div class="header-content">
        <h1 class="site-title editable" data-scope="meta" data-field="title">Hokkiadoâ›·ï¸</h1>
        <div class="nav-menu">
            <div class="nav-item active" onclick="switchTab('schedule')">
                <i class="fas fa-calendar-alt"></i> è¡Œç¨‹
            </div>
            <div class="nav-item" onclick="switchTab('shopping')">
                <i class="fas fa-shopping-cart"></i> å¿…è²·
            </div>
            <div class="nav-item" onclick="switchTab('expenses')">
                <i class="fas fa-yen-sign"></i> èŠ±è²»
            </div>
        </div>
    </div>
</header>

<div class="container">
    
    <div id="tab-schedule" class="tab-content active">
        <div id="schedule-list"></div>
    </div>

    <div id="tab-shopping" class="tab-content">
        <h2 style="margin-bottom: 20px;">ğŸ›ï¸ è³¼ç‰©/ä¼´æ‰‹ç¦®æ¸…å–®</h2>
        <div class="shopping-nav">
            <button id="btn-luna" class="active" onclick="switchShoppingList('luna')">Luna æ¸…å–®</button>
            <button id="btn-jen" onclick="switchShoppingList('jen')">Jen æ¸…å–®</button>
        </div>

        <div id="shopping-list"></div>
        <div style="text-align: center; margin-top: 20px; color: #999; font-size: 0.9rem;">
            (ç·¨è¼¯æ¨¡å¼ä¸‹å¯ä¿®æ”¹æ–‡å­—ï¼Œé»æ“Šåœˆåœˆå¯æ‰“å‹¾)
        </div>
    </div>

    <div id="tab-expenses" class="tab-content">
        <h2 style="margin-bottom: 20px;">ğŸ’° é ç®—èˆ‡èŠ±è²»</h2>
        <table class="expense-table">
            <thead>
                <tr>
                    <th width="30%">é …ç›®</th>
                    <th width="20%">é¡åˆ¥</th>
                    <th width="20%">ä»˜æ¬¾äºº</th>
                    <th>é‡‘é¡ (JPY)</th>
                </tr>
            </thead>
            <tbody id="expense-list"></tbody>
        </table>
    </div>

</div>

<div class="controls">
    <button class="btn-edit" onclick="toggleEditMode()">âœï¸ ç·¨è¼¯å…§å®¹</button>
    <button class="btn-save" onclick="saveData()">ğŸ’¾ å„²å­˜å…¨éƒ¨</button>
</div>

<script>
// --- 1. è³‡æ–™çµæ§‹èˆ‡é è¨­å€¼ ---
const defaultData = {
    meta: { title: "Hokkiadoâ›·ï¸" },
    schedule: [
        {
          id: "d1", label: "Day1 12/24",
          weather: { status: "æŠµé”æ—¥", temp: "-1", feels: "-8" },
          events: [
            { time: "09:30", tag: "å»ç¨‹", title: "æ¡ƒåœ’æ©Ÿå ´å ±åˆ°", sub: "é…·èˆª TR892", note: "èµ·é£›å‰3å°æ™‚åˆ°" },
            { time: "17:20", tag: "æŠµé”", title: "æ–°åƒæ­²æ©Ÿå ´", sub: "é ˜è¡Œæã€æ­è»Š", note: "å…ˆè²·å€‹é£¯ç³°", map_url: "https://maps.app.goo.gl/3547Gq83L3F7E3qT6" },
            { time: "19:30", tag: "å…¥ä½", title: "VESSEL HOTEL", sub: "ä¸­å³¶å…¬åœ’", note: "é™„è¿‘æœ‰Lawson", map_url: "https://maps.app.goo.gl/wS78r9Qz1VzQ5T2G7" }
          ]
        },
        {
          id: "d2", label: "Day2 12/25",
          weather: { status: "æ»‘é›ªæ—¥", temp: "-6", feels: "-12" },
          events: [
            { time: "08:00", tag: "å‡ºç™¼", title: "å‰å¾€æ‰‹ç¨»é›ªå ´", sub: "JR+å·´å£«", note: "è¨˜å¾—å¸¶æ‰‹å¥—", map_url: "https://maps.app.goo.gl/S6M9Uj2X7P4A5B7T8" },
            { time: "12:00", tag: "åˆé¤", title: "é›ªå ´é£Ÿå ‚", sub: "å’–å“©é£¯/æ‹‰éºµ", note: "ç´„1500æ—¥å¹£" },
            { time: "18:00", tag: "æ™šé¤", title: "æ¹¯å’–å“©", sub: "Suage+", note: "è¦æ’éšŠ", map_url: "https://maps.app.goo.gl/G2Q3K4R5S6T7U8V9W" }
          ]
        }
    ],
    shopping: {
        luna: [
            { item: "ç™½è‰²æˆ€äºº", note: "é€åŒäº‹", checked: false },
            { item: "è—¥å¦: åˆåŠ›ä»–å‘½", note: "å¹«åª½åª½è²·", checked: false }
        ],
        jen: [
            { item: "å…­èŠ±äº­ å¥¶æ²¹å¤¾å¿ƒ", note: "è‡ªç•™", checked: false },
            { item: "åŒ—è“æ¨“ æ³¡èŠ™", note: "æ©Ÿå ´åƒ", checked: false }
        ]
    },
    expenses: [
        { item: "æ©Ÿç¥¨", type: "äº¤é€š", cost: 12000, payer: "å…¬åŸºé‡‘" },
        { item: "ä½å®¿ (5æ™š)", type: "ä½å®¿", cost: 25000, payer: "Jen" },
        { item: "æ»‘é›ªç¥¨", type: "å¨›æ¨‚", cost: 6000, payer: "Luna" },
        { item: "é å‚™é‡‘", type: "é›œæ”¯", cost: 50000, payer: "å…¬åŸºé‡‘" }
    ]
};

// --- 2. åˆå§‹åŒ–èˆ‡è®€å– ---
let tripData = JSON.parse(localStorage.getItem('myFullTripData')) || defaultData;
let activeShoppingList = 'luna'; // æ–°å¢ç‹€æ…‹ï¼šç›®å‰é¡¯ç¤ºèª°çš„è³¼ç‰©æ¸…å–®

// --- 3. æ¸²æŸ“ç•«é¢ (Render) ---
function renderAll() {
    // A. æ¸²æŸ“æ¨™é¡Œ
    document.querySelector('.site-title').innerText = tripData.meta.title;

    // B. æ¸²æŸ“è¡Œç¨‹ (Schedule)
    const sContainer = document.getElementById('schedule-list');
    sContainer.innerHTML = '';
    tripData.schedule.forEach((day, dIndex) => {
        let eventsHtml = day.events.map((ev, eIndex) => {
            const mapIconHtml = ev.map_url ? 
                `<a href="${ev.map_url}" target="_blank" class="map-icon" title="Googleåœ°åœ–é€£çµ">
                    <i class="fas fa-map-marker-alt"></i>
                </a>` : '';
            
            return `
                <div class="event-card">
                    ${mapIconHtml}
                    <div>
                        <span class="time-badge editable" data-scope="schedule" data-d="${dIndex}" data-e="${eIndex}" data-key="time">${ev.time}</span>
                        <span class="tag-badge editable" data-scope="schedule" data-d="${dIndex}" data-e="${eIndex}" data-key="tag">${ev.tag}</span>
                    </div>
                    <div class="event-title editable" data-scope="schedule" data-d="${dIndex}" data-e="${eIndex}" data-key="title">${ev.title}</div>
                    <div class="event-sub editable" data-scope="schedule" data-d="${dIndex}" data-e="${eIndex}" data-key="sub">${ev.sub}</div>
                    <div class="event-note editable" data-scope="schedule" data-d="${dIndex}" data-e="${eIndex}" data-key="note">${ev.note}</div>
                </div>
            `;
        }).join('');

        sContainer.innerHTML += `
            <div class="day-section">
                <div class="day-header">
                    <div class="day-title editable" data-scope="schedule" data-d="${dIndex}" data-key="label">${day.label}</div>
                    <div class="weather-info">
                        <span class="editable" data-scope="schedule" data-d="${dIndex}" data-key="weather.status">${day.weather.status}</span><br>
                        <span class="editable" data-scope="schedule" data-d="${dIndex}" data-key="weather.temp">${day.weather.temp}</span>Â°C
                    </div>
                </div>
                <div>${eventsHtml}</div>
            </div>
        `;
    });

    // C. æ¸²æŸ“è³¼ç‰©æ¸…å–® (Shopping) - é è¨­æˆ–ä¸Šæ¬¡é¸ä¸­çš„æ¸…å–®
    renderShoppingList(activeShoppingList);

    // D. æ¸²æŸ“èŠ±è²» (Expenses)
    const expContainer = document.getElementById('expense-list');
    expContainer.innerHTML = tripData.expenses.map((ex, index) => `
        <tr>
            <td><div class="editable" data-scope="expenses" data-i="${index}" data-key="item">${ex.item}</div></td>
            <td><div class="editable" data-scope="expenses" data-i="${index}" data-key="type">${ex.type}</div></td>
            <td><div class="editable" data-scope="expenses" data-i="${index}" data-key="payer">${ex.payer}</div></td>
            <td><div class="editable" data-scope="expenses" data-i="${index}" data-key="cost">${ex.cost}</div></td>
        </tr>
    `).join('');
    
    // è¨ˆç®—ç¸½èŠ±è²»
    const total = tripData.expenses.reduce((sum, item) => sum + Number(item.cost), 0);
    expContainer.innerHTML += `
        <tr class="total-row">
            <td colspan="3">ç¸½é ä¼°èŠ±è²»</td>
            <td>Â¥ ${total.toLocaleString()}</td>
        </tr>
    `;
}

// --- 4. åˆ†é åˆ‡æ› ---
function switchTab(tabId) {
    // éš±è—æ‰€æœ‰åˆ†é 
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    
    // é¡¯ç¤ºé¸ä¸­åˆ†é 
    document.getElementById('tab-' + tabId).classList.add('active');
    // ç°¡å–®çš„é«˜äº®é‚è¼¯
    const index = ['schedule', 'shopping', 'expenses'].indexOf(tabId);
    document.querySelectorAll('.nav-item')[index].classList.add('active');
}

// --- 5. è³¼ç‰©æ¸…å–®å°ˆå±¬åŠŸèƒ½ ---
function renderShoppingList(listName) {
    activeShoppingList = listName; // æ›´æ–°ç›®å‰é¸ä¸­çš„æ¸…å–®
    
    // æ›´æ–°æŒ‰éˆ•é«˜äº®ç‹€æ…‹
    document.getElementById('btn-luna').classList.remove('active');
    document.getElementById('btn-jen').classList.remove('active');
    document.getElementById('btn-' + listName).classList.add('active');

    const list = tripData.shopping[listName] || [];
    const shopContainer = document.getElementById('shopping-list');
    
    shopContainer.innerHTML = list.map((item, index) => `
        <div class="shopping-item">
            <div class="check-box ${item.checked ? 'checked' : ''}" onclick="toggleCheck('${listName}', ${index})">
                <i class="fas fa-check-circle"></i>
            </div>
            <div style="flex:1;">
                <div class="editable" style="font-weight:bold" data-scope="shopping" data-list="${listName}" data-i="${index}" data-key="item">${item.item}</div>
                <div class="editable" style="font-size:0.9em; color:#666" data-scope="shopping" data-list="${listName}" data-i="${index}" data-key="note">${item.note}</div>
            </div>
        </div>
    `).join('');
}

function switchShoppingList(listName) {
    renderShoppingList(listName);
}

// è³¼ç‰©æ¸…å–®æ‰“å‹¾åŠŸèƒ½
function toggleCheck(listName, index) {
    tripData.shopping[listName][index].checked = !tripData.shopping[listName][index].checked;
    saveToLocal(); // è‡ªå‹•å­˜
    renderShoppingList(listName); // åªé‡æ–°æ¸²æŸ“ç•¶å‰æ¸…å–®
}

// --- 6. ç·¨è¼¯èˆ‡å„²å­˜æ ¸å¿ƒé‚è¼¯ ---
function toggleEditMode() {
    document.body.classList.toggle('editing');
    const isEditing = document.body.classList.contains('editing');
    document.querySelectorAll('.editable').forEach(el => el.contentEditable = isEditing);
}

function saveData() {
    // æƒæé é¢ä¸Šæ‰€æœ‰ .editable å…ƒç´ ä¸¦æ›´æ–°å›è³‡æ–™çµæ§‹
    document.querySelectorAll('.editable').forEach(el => {
        const scope = el.dataset.scope;
        const val = el.innerText;
        
        if (scope === 'meta') {
            tripData.meta[el.dataset.field] = val;
        } else if (scope === 'schedule') {
            const d = el.dataset.d;
            const key = el.dataset.key;
            if (key.includes('weather.')) {
                const wKey = key.split('.')[1];
                tripData.schedule[d].weather[wKey] = val;
            } else if (key === 'label') {
                tripData.schedule[d].label = val;
            } else {
                const e = el.dataset.e;
                tripData.schedule[d].events[e][key] = val;
            }
        } else if (scope === 'shopping') {
            const listName = el.dataset.list;
            const i = el.dataset.i;
            tripData.shopping[listName][i][el.dataset.key] = val;
        } else if (scope === 'expenses') {
            const i = el.dataset.i;
            tripData.expenses[i][el.dataset.key] = val;
        }
    });

    saveToLocal();
    toggleEditMode();
    renderAll(); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°åŠ ç¸½æ•¸å­—å’Œæ‰€æœ‰å…§å®¹
    alert('âœ… å…¨éƒ¨è³‡æ–™å·²å„²å­˜ï¼');
}

function saveToLocal() {
    localStorage.setItem('myFullTripData', JSON.stringify(tripData));
}

// *** è¨»ï¼šå·²ç§»é™¤ resetData() åŠŸèƒ½ï¼Œç¢ºä¿è³‡æ–™ä¸æœƒè¢«èª¤åˆª ***

// å•Ÿå‹•
renderAll();
// ç¢ºä¿ä¸€é–‹å§‹é¡¯ç¤ºè¡Œç¨‹åˆ†é 
switchTab('schedule');

</script>
</body>
</html>
