<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æµ·é“æ»‘é›ªè¡Œç¨‹è¡¨</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f5f7fa;
            --card-bg: #ffffff;
            --text: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 60px;
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 50px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        button {
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .btn-edit { background: var(--primary); color: white; }
        .btn-save { background: #27ae60; color: white; display: none; }
        .btn-reset { background: #e74c3c; color: white; display: none; }
        
        button:hover { opacity: 0.9; transform: translateY(-1px); }

        /* ç·¨è¼¯æ¨¡å¼ä¸‹çš„æ¨£å¼ */
        body.editing .editable {
            border-bottom: 1px dashed #999;
            background-color: #fffyellow;
            padding: 0 2px;
            cursor: text;
        }
        body.editing .btn-save, body.editing .btn-reset { display: block; }
        body.editing .btn-edit { display: none; }

        /* è¡Œç¨‹å¡ç‰‡æ¨£å¼ */
        .day-section {
            margin-bottom: 40px;
        }

        .day-header {
            position: sticky;
            top: 0;
            background: var(--bg);
            padding: 15px 0;
            z-index: 10;
            border-bottom: 2px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .day-title { font-size: 1.5rem; font-weight: 800; color: var(--primary); }
        
        .weather-info {
            font-size: 0.9rem;
            color: #666;
            text-align: right;
        }

        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #ddd;
        }

        .event-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            margin-left: 50px;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .event-card::before {
            content: '';
            position: absolute;
            left: -36px;
            top: 20px;
            width: 14px;
            height: 14px;
            background: var(--accent);
            border-radius: 50%;
            border: 3px solid var(--bg);
        }

        .time-badge {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .tag-badge {
            display: inline-block;
            background: #eee;
            color: #555;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 5px;
        }

        .event-title { font-size: 1.1rem; font-weight: bold; margin: 5px 0; }
        .event-sub { font-size: 0.95rem; color: #555; margin-bottom: 5px; }
        .event-note { 
            font-size: 0.9rem; 
            color: #666; 
            background: #f8f9fa; 
            padding: 8px; 
            border-radius: 6px; 
            margin-top: 5px;
        }
    </style>
</head>
<body>

<div class="container" id="schedule-container">
    </div>

<div class="controls">
    <button class="btn-edit" onclick="toggleEditMode()">âœï¸ ç·¨è¼¯è¡Œç¨‹</button>
    <button class="btn-save" onclick="saveData()">ğŸ’¾ å„²å­˜ä¿®æ”¹</button>
    <button class="btn-reset" onclick="resetData()">â†º é‡ç½®å›é è¨­</button>
</div>

<script>
// 1. åŸå§‹è³‡æ–™ (é è¨­å€¼)
const defaultDays = [
    {
      id: "2025-12-24",
      label: "Day1 12/24",
      weather: { temp: -1, low: -6, feels: -8, status: "æŠµé”æ—¥ Â· å¤©æ°£å¾…æŸ¥", note: "å…ˆæŠŠè¡£æœç©¿åœ¨èº«ä¸Šå°±å°äº†" },
      schedule: [
        { time: "09:30", tag: "å»ç¨‹", title: "æ¡ƒåœ’æ©Ÿå ´å ±åˆ°", sub: "TPE Â· é…·èˆª TR892", note: "å»ºè­°èµ·é£›å‰ 3 å°æ™‚åˆ°æ©Ÿå ´" },
        { time: "12:30", tag: "å»ç¨‹", title: "TR892 TPE â†’ CTS", sub: "é…·èˆª TR892 12:30 èµ·é£›", note: "é è¨ˆ 17:20 æŠµé”æ–°åƒæ­²æ©Ÿå ´" },
        { time: "17:20", tag: "æŠµé”", title: "æ–°åƒæ­²æ©Ÿå ´ (CTS)", sub: "å…¥å¢ƒã€é ˜è¡Œæã€æ­è»Šå‰å¾€æœ­å¹Œ", note: "å¯åœ¨æ©Ÿå ´å…ˆé ˜ IC å¡ / ä¸Šå»æ‰€ / å°è£œçµ¦" },
        { time: "19:30", tag: "å…¥ä½", title: "VESSEL HOTEL ä¸­å³¶å…¬åœ’", sub: "12/24â€“12/26 Â· 14:00 å…¥ä½", note: "æ”¾å¥½è¡Œæï¼Œå¯å»é™„è¿‘è¶…å¸‚ã€ä¾¿åˆ©å•†åº—è¦“é£Ÿ" },
        { time: "21:00", tag: "TBD", title: "æœ­å¹Œå¤œæ•£æ­¥", sub: "å¤§é€šå…¬åœ’ / ç‹¸å°è·¯", note: "é€™æ ¼ä½ ä¹‹å¾Œå¯ä»¥è‡ªå·±æ”¹æˆç¢ºå®šçš„è¡Œç¨‹" }
      ]
    },
    {
      id: "2025-12-25",
      label: "Day2 12/25",
      weather: { temp: -5, low: -10, feels: -12, status: "Klook ä¸€æ—¥éŠ", note: "æ—­å±±å‹•ç‰©åœ’ + é’æ±  + ç™½é¬šç€‘å¸ƒ" },
      schedule: [
        { time: "07:50", tag: "å»ç¨‹", title: "é›†åˆå‡ºç™¼", sub: "æœ­å¹Œ â†’ æ—­å·æ–¹å‘", note: "Klook ä¸€æ—¥éŠé›†åˆåœ°é»ï¼ˆä¾æ†‘è­‰ç‚ºä¸»ï¼‰" },
        { time: "10:30", tag: "æ™¯é»", title: "æ—­å±±å‹•ç‰©åœ’", sub: "ç´„ 1 å°æ™‚ 40 åˆ† Â· è‡ªç”±æ´»å‹•", note: "æœ¬è¡Œç¨‹åŒ…å«æ—­å±±å‹•ç‰©åœ’é–€ç¥¨" },
        { time: "13:10", tag: "æ™¯é»", title: "ç™½é‡‘é’æ± ", sub: "ç´„ 15 åˆ†é˜ Â· è‡ªç”±æ´»å‹•", note: "æ‹è—è‰²æ± æ°´ã€é›ªæ™¯" },
        { time: "13:30", tag: "æ™¯é»", title: "ç™½é¬šç€‘å¸ƒ", sub: "ç´„ 25 åˆ†é˜ Â· è‡ªç”±æ´»å‹•", note: "ç€‘å¸ƒ + é›ªæ™¯ Â· è¶…ç´šç¾" },
        { time: "15:00", tag: "æ™¯é»", title: "æ£®æ—ç²¾éˆéœ²è‡º", sub: "ç´„ 1 å°æ™‚ 20 åˆ† Â· è‡ªç”±æ´»å‹•", note: "ç²¾éˆéœ²è‡ºæ•£æ­¥ã€æ‹ç…§ã€å–æ±è¥¿" },
        { time: "18:30", tag: "å›ç¨‹", title: "è¿”å›æœ­å¹Œ", sub: "å›åˆ°é›†åˆåœ°é»é™„è¿‘è§£æ•£", note: "å›é£¯åº—ä¼‘æ¯ / æ™šé¤å¾…æ±ºå®š (TBD)" }
      ]
    },
    {
      id: "2025-12-26",
      label: "Day3 12/26",
      weather: { temp: -3, low: -8, feels: -10, status: "å¸‚å€ç§»å‹•æ—¥", note: "ç™½å¤©å¸‚å€é€›è¡— + æ›é£¯åº—" },
      schedule: [
        { time: "11:00", tag: "é€€æˆ¿", title: "é€€æˆ¿ Â· VESSEL HOTEL", sub: "æœ€æ™š 11:00 é€€æˆ¿", note: "è¡Œæå¯å¯„æ”¾åœ¨æ«ƒå°ï¼Œç™½å¤©å»é€›è¡—" },
        { time: "12:00", tag: "TBD", title: "æœ­å¹Œå¸‚å€è¡Œç¨‹", sub: "å¤§é€šå…¬åœ’ / ç‹¸å°è·¯ / æœ­å¹Œè»Šç«™", note: "ç™½å¤©è¡Œç¨‹å…ˆæ¨™è¨˜ TBDï¼Œä¹‹å¾Œä½ è‡ªå·±æ”¹" },
        { time: "15:00", tag: "å…¥ä½", title: "ç›¸éµ FRESA INN è–„é‡", sub: "12/26â€“12/29 Â· 15:00 å…¥ä½", note: "æ”¾è¡Œæå¾Œå¯å»è–„é‡åƒæ™šé¤ã€çœ‹å¤œæ™¯" }
      ]
    },
    {
      id: "2025-12-27",
      label: "Day4 12/27",
      weather: { temp: -6, low: -12, feels: -15, status: "æ‰‹ç¨»æ»‘é›ªæ—¥", note: "é›ªé•·å§ Â· æ‰‹ç¨»æ»‘é›ªå ´" },
      schedule: [
        { time: "07:00", tag: "å‡ºç™¼", title: "æœ­å¹Œ â†’ æ‰‹ç¨»æ»‘é›ªå ´", sub: "æ­ JR / å·´å£«", note: "å»ºè­°å‰ä¸€å¤©å…ˆç¢ºèªè»Šç­æ™‚é–“" },
        { time: "09:00", tag: "æ»‘é›ª", title: "é›†åˆ & ç§Ÿè£å‚™", sub: "èˆ‡é›ªé•·å§æœƒåˆ", note: "ç§Ÿæ¿ã€é›ªè¡£ã€è­·å…·ç­‰" },
        { time: "10:00", tag: "æ»‘é›ª", title: "æ»‘é›ªæ•™å­¸ & è‡ªç”±æ»‘", sub: "ä¸­åˆå¯åœ¨é›ªå ´ç”¨é¤", note: "è¡Œç¨‹ç´°ç¯€ä¹‹å¾Œå†æ”¹æ–‡å­—å°±å¥½" },
        { time: "16:00", tag: "å›ç¨‹", title: "é›¢é–‹æ‰‹ç¨»æ»‘é›ªå ´", sub: "æ­è»Šè¿”å›æœ­å¹Œ", note: "å›åˆ°è–„é‡é™„è¿‘åƒæ™šé¤ / æ³¡æ¹¯ TBD" }
      ]
    },
    {
      id: "2025-12-28",
      label: "Day5 12/28",
      weather: { temp: -6, low: -12, feels: -15, status: "è‡ªç”±æ»‘é›ªæ—¥", note: "è‡ªç”±å®‰æ’å†å»æ»‘é›ª / æœ­å¹Œå¸‚å€" },
      schedule: [
        { time: "TBD", tag: "è¡Œç¨‹", title: "è‡ªç”±æ»‘é›ª or å¸‚å€è¡Œç¨‹", sub: "å¯æ±ºå®šè¦ä¸è¦å†å»æ‰‹ç¨»æˆ–å…¶ä»–é›ªå ´", note: "å…ˆæ”¾ä¸€æ ¼ TBDï¼Œä¹‹å¾Œæƒ³å¥½å†æ”¹" }
      ]
    },
    {
      id: "2025-12-29",
      label: "Day6 12/29",
      weather: { temp: -3, low: -8, feels: -10, status: "å›ç¨‹æ—¥", note: "æ”¶æ‹¾è¡Œæ + æ©Ÿå ´æ¡è²·" },
      schedule: [
        { time: "11:00", tag: "é€€æˆ¿", title: "é€€æˆ¿ Â· ç›¸éµ FRESA INN", sub: "æœ€æ™š 11:00 é€€æˆ¿", note: "å¯å…ˆæŠŠè¡Œæå¸¶å»æœ­å¹Œç«™å¯„ç‰©" },
        { time: "12:00", tag: "äº¤é€š", title: "æœ­å¹Œ â†’ æ–°åƒæ­²æ©Ÿå ´", sub: "æ­ JR / å·´å£«å‰å¾€ CTS", note: "ç•™ä¸€é»æ™‚é–“åœ¨æ©Ÿå ´é€›è¡—ã€è²·ä¼´æ‰‹ç¦®" },
        { time: "13:55", tag: "å›ç¨‹", title: "FD243 CTS â†’ TPE", sub: "Airasia FD243 13:55 èµ·é£›", note: "é è¨ˆ 17:55 æŠµé”å°åŒ—" }
      ]
    }
];

// 2. åˆå§‹åŒ–è³‡æ–™ (å„ªå…ˆè®€å– Local Storage)
let days = JSON.parse(localStorage.getItem('myTripData')) || defaultDays;
const container = document.getElementById('schedule-container');

// 3. æ¸²æŸ“ç•«é¢å‡½æ•¸
function render() {
    container.innerHTML = '';
    
    days.forEach((day, dIndex) => {
        let itemsHtml = '';
        day.schedule.forEach((item, iIndex) => {
            itemsHtml += `
            <div class="event-card">
                <span class="time-badge editable" data-d="${dIndex}" data-i="${iIndex}" data-field="time">${item.time}</span>
                <span class="tag-badge editable" data-d="${dIndex}" data-i="${iIndex}" data-field="tag">${item.tag}</span>
                <div class="event-title editable" data-d="${dIndex}" data-i="${iIndex}" data-field="title">${item.title}</div>
                <div class="event-sub editable" data-d="${dIndex}" data-i="${iIndex}" data-field="sub">${item.sub}</div>
                <div class="event-note editable" data-d="${dIndex}" data-i="${iIndex}" data-field="note">${item.note}</div>
            </div>`;
        });

        const section = document.createElement('div');
        section.className = 'day-section';
        section.innerHTML = `
            <div class="day-header">
                <div class="day-title editable" data-d="${dIndex}" data-type="header" data-field="label">${day.label}</div>
                <div class="weather-info">
                    <div class="editable" data-d="${dIndex}" data-type="weather" data-field="status">${day.weather.status}</div>
                    <div style="font-size:0.8em">
                        <span class="editable" data-d="${dIndex}" data-type="weather" data-field="temp">${day.weather.temp}</span>Â°C 
                        (é«”æ„Ÿ <span class="editable" data-d="${dIndex}" data-type="weather" data-field="feels">${day.weather.feels}</span>Â°C)
                    </div>
                </div>
            </div>
            <div class="timeline">
                ${itemsHtml}
            </div>
        `;
        container.appendChild(section);
    });
}

// 4. ç·¨è¼¯åŠŸèƒ½é‚è¼¯
function toggleEditMode() {
    document.body.classList.toggle('editing');
    const isEditing = document.body.classList.contains('editing');
    
    // è¨­å®šæ‰€æœ‰æ¨™è¨˜ç‚º editable çš„å…ƒç´ æ˜¯å¦å¯ç·¨è¼¯
    document.querySelectorAll('.editable').forEach(el => {
        el.contentEditable = isEditing;
    });
}

function saveData() {
    // éæ­·æ‰€æœ‰ DOM å…ƒç´ ä¸¦å›å¯«åˆ° days ç‰©ä»¶
    document.querySelectorAll('.editable').forEach(el => {
        const d = el.dataset.d;
        const i = el.dataset.i; // è¡Œç¨‹ index
        const field = el.dataset.field;
        const type = el.dataset.type; // ç”¨ä¾†å€åˆ†æ˜¯ weather é‚„æ˜¯ä¸€èˆ¬è¡Œç¨‹

        if (type === 'header') {
             days[d][field] = el.innerText;
        } else if (type === 'weather') {
             days[d].weather[field] = el.innerText; // é€™è£¡ç°¡å–®å­˜ç‚ºæ–‡å­—ï¼Œå¦‚æœéœ€è¦æ•¸å­—é‹ç®—éœ€ parseFloat
        } else {
             days[d].schedule[i][field] = el.innerText;
        }
    });

    // å­˜å…¥ Local Storage
    localStorage.setItem('myTripData', JSON.stringify(days));
    
    // é—œé–‰ç·¨è¼¯æ¨¡å¼
    toggleEditMode();
    alert('âœ… è¡Œç¨‹å·²å„²å­˜ï¼(è³‡æ–™åƒ…å­˜åœ¨æ‚¨çš„ç€è¦½å™¨ä¸­)');
}

function resetData() {
    if(confirm('ç¢ºå®šè¦é‡ç½®å›æœ€åŸå§‹çš„ç¯„æœ¬å—ï¼Ÿæ‚¨ä¿®æ”¹çš„è³‡æ–™å°‡æœƒæ¶ˆå¤±ã€‚')) {
        localStorage.removeItem('myTripData');
        days = JSON.parse(JSON.stringify(defaultDays)); // æ·±æ‹·è²é‡ç½®
        render();
        toggleEditMode(); // é—œé–‰ç·¨è¼¯æ¨¡å¼
    }
}

// å•Ÿå‹•æ¸²æŸ“
render();

</script>

</body>
</html>
